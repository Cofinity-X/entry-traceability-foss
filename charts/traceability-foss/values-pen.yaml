#
# Copyright (c) 2023 Contributors to the Eclipse Foundation
#
# See the NOTICE file(s) distributed with this work for additional
# information regarding copyright ownership.
#
# This program and the accompanying materials are made available under the
# terms of the Apache License, Version 2.0 which is available at
# https://www.apache.org/licenses/LICENSE-2.0.
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.
#
# SPDX-License-Identifier: Apache-2.0
#

configuration:
  env:
    bpn: &bpn 'BPNL00000003AYRE'

  frontend:
    name: &fe_name 'traceability-foss-pen-frontend'
    hostName: &fe_host_name 'traceability-portal-pen.dev.demo.catena-x.net'
    backendApiUrl: &be_api_url 'https://traceability-pen.dev.demo.catena-x.net/api'

  backend:
    name: &backend_name 'product-traceability-foss-pen-backend'
    hostName: &be_host_name 'traceability-pen.dev.demo.catena-x.net'
    # -- backend host with https://
    url: &be_url 'https://traceability-pen.dev.demo.catena-x.net'
    edcClient:
      callbackUrl: &backend_edc_client_callback_url ''
    backendDatabase:
      url: &backend_database_url 'jdbc:postgresql://tracex-backend-pen-postgresql:5432/trace'
      name: &backend_database_name 'tracex-backend-pen-postgresql'
      password: &backend_database_password <path:traceability-foss/data/pen/database#tracePassword>
      rootPassword: &backend_database_root_password <path:traceability-foss/data/pen/database#postgresPassword>
    security:
      # -- required to allow FE connection
      allowedCorsOrigins: &backend_security_allowed_fe 'https://traceability-portal-pen.dev.demo.catena-x.net/'

  pgadmin4:
    name: &pgadmin_name 'tracex-pen-pgadmin'
    hostName: &pgadmin_host_name 'tracex-pen-pgadmin4.dev.demo.catena-x.net'
    password: &pgadmin_password <path:traceability-foss/data/pen/database#pgadminPassword>

  irs:
    url: &irs_url 'https://tx-irs-pen.dev.demo.catena-x.net'
    callbackUrl: &irs_callback_url 'http://tx-irs-pen:8181/internal/endpoint-data-reference'

  edc:
   controlplane:
      url: &edc_controlplane_url ''
      managementUrl: &edc_controlplane_management_url ''

  portal:
    domain: &portal_domain 'catena-x.net'
    url: &portal_url https://portal.int.demo.catena-x.net/
    backend:
      url: &portal_backend_url 'https://portal-backend.int.demo.catena-x.net/api'
    discoveryFinderUrl: &discovery_finder_url 'https://semantics.int.demo.catena-x.net/discoveryfinder/api/v1.0/administration/connectors/discovery/search'
    serviceAccount:
      clientId: &service_account_id <path:traceability-foss/data/pen/keycloak/oauth2#clientId> # sa-cl6-cx-10
      clientPassword: &service_account_password <path:traceability-foss/data/pen/keycloak/oauth2#clientSecret>
    auth:
      keycloakUrl: &portal_auth_keycloak_url 'https://centralidp-pen.dev.demo.catena-x.net/auth'
      tokenUri: &central_idp_token_uri 'https://centralidp-pen.dev.demo.catena-x.net/auth/realms/CX-Central/protocol/openid-connect/token'
      jwkUri: &central_idp_jwk_uri 'https://centralidp-pen.dev.demo.catena-x.net/auth/realms/CX-Central/protocol/openid-connect/certs'
      resourceClient: &central_idp_resource_client 'Cl17-CX-Part'

  digitalTwinRegistry:
    url: &dtr_url ''

#########################
# Global Values configuration     #
#########################
global:
  enablePrometheus: false
  enableGrafana: false

#########################
# Frontend Chart Values configuration     #
#########################
frontend:
  nameOverride: *fe_name
  fullnameOverride: *fe_name
  livenessProbe:
    failureThreshold: 3
    initialDelaySeconds: 60
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  readinessProbe:
    failureThreshold: 3
    initialDelaySeconds: 60
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  image:
    repository: ghcr.io/catenax-ng/tx-traceability-foss
    tag: $ARGOCD_APP_REVISION
    CATENAX_PORTAL_API_URL: *be_api_url
    CATENAX_PORTAL_KEYCLOAK_URL: *portal_auth_keycloak_url
    CATENAX_PORTAL_BACKEND_DOMAIN: *portal_domain
    CATENAX_PORTAL_URL: *portal_url
    CATENAX_PORTAL_CLIENT_ID: *central_idp_resource_client

  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - host: *fe_host_name
        paths:
          - path: /
            pathType: ImplementationSpecific
    tls:
      - hosts:
          - *fe_host_name
        secretName: tls-secret

#########################
# Backend Chart Values configuration     #
#########################
backend:
  nameOverride: *backend_name
  fullnameOverride: *backend_name
  livenessProbe:
    failureThreshold: 3
    initialDelaySeconds: 60
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  readinessProbe:
    failureThreshold: 3
    initialDelaySeconds: 60
    periodSeconds: 10
    successThreshold: 1
    timeoutSeconds: 1
  image:
    repository: ghcr.io/catenax-ng/tx-traceability-foss
    tag: $ARGOCD_APP_REVISION

  podSecurityContext:
    runAsUser: 10001
    seccompProfile:
      type: RuntimeDefault

  # Following Catena-X Helm Best Practices @url: https://catenax-ng.github.io/docs/kubernetes-basics/helm
  # @url: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod
  securityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 10001
    runAsGroup: 3000
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false

  # Following Catena-X Helm Best Practices @url: https://catenax-ng.github.io/docs/kubernetes-basics/helm
  # @url: https://cloud.google.com/blog/products/containers-kubernetes/kubernetes-best-practices-resource-requests-and-limits
  resources:
    limits:
      cpu: 1500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi

  springprofile: dev

  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/backend-protocol: HTTP
    hosts:
      - host: *be_host_name
        paths:
          - path: /
            pathType: ImplementationSpecific
    tls:
      - hosts:
          - *be_host_name
        secretName: tls-secret

  traceability:
    bpn: *bpn
    url: *be_url

  datasource:
    url: *backend_database_url
    username: 'trace'
    password: *backend_database_password


  oauth2:
    clientId: *service_account_id
    clientSecret: *service_account_password
    clientTokenUri: *central_idp_token_uri
    jwkSetUri: *central_idp_jwk_uri
    resourceClient: *central_idp_resource_client

  edc:
    apiKey: ''
    providerUrl: *edc_controlplane_url
    providerDataplaneUrl: *edc_provider_dataplane_url
    callbackUrl: *irs_callback_url
    callbackUrlEdcClient: *backend_edc_client_callback_url
    dataEndpointUrl: *edc_controlplane_management_url

  discoveryfinder:
    baseUrl: *discovery_finder_url

  submodel:
    baseUrl: *be_url
  irs:
    baseUrl: *irs_url
  registry:
    urlWithPath: *dtr_url
  portal:
    baseUrl: *portal_backend_url

  config:
    allowedCorsOriginFirst: "http://localhost:4200/"
    allowedCorsOriginSecond: *backend_security_allowed_fe

  dependencies:
    enabled: false
    irs: 'CHANGE_ME'  # <irs-helm.nameOverride>
    edc: 'CHANGE_ME'  # <tractusx-connector.nameOverride

#########################
# PG Admin configuration     #
#########################
pgadmin4:
  nameOverride: *pgadmin_name
  fullnameOverride: *pgadmin_name
  enabled: true
  strategy:
    type: Recreate
  networkPolicy:
    enabled: false
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/backend-protocol: HTTP
    hosts:
      - host: *pgadmin_host_name
        paths:
          - path: /
            pathType: Prefix
    tls:
      - hosts:
          - *pgadmin_host_name
        secretName: tls-secret
  env:
    email: pgadmin4@trace.foss
    password: *pgadmin_password
    variables:
      - name: PGADMIN_CONFIG_UPGRADE_CHECK_ENABLED
        value: "False"
  resources:
    limits:
      cpu: 768m
      memory: 768Mi
    requests:
      cpu: 100m
      memory: 256Mi

#########################
# Postgres configuration     #
#########################
postgresql:
  enabled: true

  nameOverride: *backend_database_name
  fullnameOverride: *backend_database_name

  auth:
    postgresPassword: *backend_database_root_password
    password: *backend_database_password
    database: "trace"
    username: "trace"  # extract to vault
#########################
# IRS configuration     #
#########################
irs-helm:
  enabled: false

###################################
# EDC Consumer configuration  #
###################################
tractusx-connector:
  enabled: false

